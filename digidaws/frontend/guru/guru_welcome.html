<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selamat Datang di DIGIDAWS</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .modal-body {
            min-height: 300px;
        }
        .guide-step {
            display: none;
        }
        .guide-step.active {
            display: block;
        }
        .progress-bar {
            transition: width 0.4s ease;
        }
    </style>
</head>
<body>

    <!-- Modal Panduan -->
    <div class="modal fade" id="welcomeGuideModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="welcomeGuideModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="welcomeGuideModalLabel">Panduan Cepat untuk Guru</h5>
                </div>
                <div class="modal-body">
                    <!-- Step 1: Welcome -->
                    <div class="guide-step active" data-step="1">
                        <h4>Selamat Datang!</h4>
                        <p>Ini adalah panduan singkat untuk membantu Anda memulai menggunakan DIGIDAWS. Ikuti beberapa langkah berikut untuk memahami fitur-fitur utama.</p>
                        <div class="text-center">
                            <i class="bi bi-rocket-takeoff" style="font-size: 5rem; color: #0d6efd;"></i>
                        </div>
                    </div>

                    <!-- Step 2: Upload & Generate Soal (UPDATED) -->
                    <div class="guide-step" data-step="2">
                        <h4>Langkah 1: Generate Soal Otomatis</h4>
                        <p>Fitur utama kami adalah kemampuan untuk membuat soal secara otomatis dari materi ajar Anda. Cukup siapkan file materi dalam format <strong>.pdf</strong> atau <strong>.docx</strong>.</p>
                        <div class="alert alert-warning">
                            <p class="fw-bold mb-2"><i class="bi bi-exclamation-triangle-fill"></i> Penting:</p>
                            Pastikan modul ajar Anda mengandung elemen-elemen berikut agar AI dapat membuat soal yang relevan: <strong>MODUL/ELEMEN AJAR, KOMPETENSI AWAL, TUJUAN PEMBELAJARAN, PEMAHAMAN BERMAKNA,</strong> dan <strong>TARGET PESERTA DIDIK</strong>. Pastikan juga terdapat maksimal satu materi ajar di dalam dokumen.
                        </div>
                        <p>Di halaman Dashboard Guru, Anda akan menemukan tombol <strong>"Upload File & Generate Soal"</strong>. Klik tombol ini, pilih file materi Anda, dan sistem AI kami akan menganalisis dan membuat bank soal adaptif untuk Anda.</p>
                        <div class="text-center">
                             <i class="bi bi-file-earmark-arrow-up" style="font-size: 5rem; color: #198754;"></i>
                        </div>
                    </div>

                    <!-- Step 3: Kelola Koleksi (Renumbered) -->
                    <div class="guide-step" data-step="3">
                        <h4>Langkah 2: Kelola Koleksi Soal</h4>
                        <p>Setelah soal dibuat, Anda dapat mengelompokkannya ke dalam "Koleksi". Sebuah koleksi adalah satu set tes yang dapat Anda tugaskan kepada siswa.</p>
                        <p>Di halaman <strong>"Koleksi Soal"</strong>, Anda dapat membuat koleksi baru, melihat detail soal di dalamnya, dan merevisi soal jika diperlukan.</p>
                         <div class="text-center">
                            <i class="bi bi-collection" style="font-size: 5rem; color: #ffc107;"></i>
                        </div>
                    </div>

                    <!-- Step 4: Validasi Soal (NEW) -->
                    <div class="guide-step" data-step="4">
                        <h4>Langkah 3: Validasi Soal</h4>
                        <p>Sebelum soal dapat dikerjakan oleh siswa, Anda perlu melakukan validasi untuk memastikan kelayakan soal (*face validity*). Ini adalah langkah penting untuk menjaga kualitas asesmen.</p>
                        <p>Masuk ke detail koleksi, lalu pada setiap soal, klik tombol <strong>"Validasi"</strong>. Soal yang belum divalidasi <strong>tidak akan tampil</strong> saat siswa mengerjakan tes. Pastikan semua soal yang ingin digunakan telah Anda validasi.</p>
                        <div class="text-center">
                            <i class="bi bi-check2-square" style="font-size: 5rem; color: #6f42c1;"></i>
                        </div>
                    </div>

                    <!-- Step 5: Tugaskan ke Siswa (Renumbered) -->
                    <div class="guide-step" data-step="5">
                        <h4>Langkah 4: Tugaskan ke Siswa</h4>
                        <p>Setelah koleksi siap dan soal-soalnya telah divalidasi, Anda bisa menugaskannya kepada siswa. Masuk ke detail koleksi, klik tombol <strong>"Kelola Siswa"</strong>.</p>
                        <p>Anda dapat menambahkan semua siswa dari satu kelas secara otomatis. Siswa yang ditambahkan akan melihat tes ini di dashboard mereka.</p>
                        <div class="text-center">
                            <i class="bi bi-person-plus" style="font-size: 5rem; color: #0dcaf0;"></i>
                        </div>
                    </div>
                    
                    <!-- Step 6: Analisis Hasil (Renumbered) -->
                    <div class="guide-step" data-step="6">
                        <h4>Langkah 5: Analisis Hasil</h4>
                        <p>Pantau kemajuan siswa melalui menu <strong>"Analisis"</strong> pada setiap kartu koleksi. Anda dapat melihat ringkasan performa kelas, distribusi level kemampuan siswa, dan mengekspor laporan dalam format PDF atau Excel.</p>
                        <p>Anda siap untuk memulai! Klik tombol di bawah untuk melanjutkan ke dashboard Anda.</p>
                        <div class="text-center">
                           <i class="bi bi-graph-up-arrow" style="font-size: 5rem; color: #dc3545;"></i>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="w-100">
                        <div class="progress mb-2" style="height: 5px;">
                            <div class="progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div id="guideNavigation" class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" id="prevStepBtn" disabled>Sebelumnya</button>
                            <button type="button" class="btn btn-primary" id="nextStepBtn">Berikutnya</button>
                        </div>
                        <div id="guideFinish" class="d-flex justify-content-center" style="display: none;">
                            <button type="button" class="btn btn-success" id="finishGuideBtn">Mengerti & Lanjutkan</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeModalElement = document.getElementById('welcomeGuideModal');
            const welcomeModal = new bootstrap.Modal(welcomeModalElement);
            const steps = welcomeModalElement.querySelectorAll('.guide-step');
            const nextBtn = welcomeModalElement.querySelector('#nextStepBtn');
            const prevBtn = welcomeModalElement.querySelector('#prevStepBtn');
            const finishBtn = welcomeModalElement.querySelector('#finishGuideBtn');
            const progressBar = welcomeModalElement.querySelector('.progress-bar');
            const guideNav = welcomeModalElement.querySelector('#guideNavigation');
            const guideFinish = welcomeModalElement.querySelector('#guideFinish');
            let currentStep = 1;
            const totalSteps = steps.length;

            function showStep(stepNumber) {
                steps.forEach(step => step.classList.remove('active'));
                welcomeModalElement.querySelector(`.guide-step[data-step="${stepNumber}"]`).classList.add('active');
                
                const progress = (stepNumber / totalSteps) * 100;
                progressBar.style.width = `${progress}%`;
                progressBar.setAttribute('aria-valuenow', progress);
                
                prevBtn.disabled = stepNumber === 1;
                
                if (stepNumber === totalSteps) {
                    guideNav.style.display = 'none';
                    guideFinish.style.display = 'flex';
                } else {
                    guideNav.style.display = 'flex';
                    guideFinish.style.display = 'none';
                }
            }

            nextBtn.addEventListener('click', () => {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            finishBtn.addEventListener('click', async () => {
                try {
                    // Tandai bahwa guru sudah melihat panduan
                    const response = await fetch('/api/guru/mark_welcome_seen', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Gagal menyimpan status panduan.');
                    }

                    const result = await response.json();
                    if (result.success) {
                        // Arahkan ke dashboard guru
                        window.location.href = '/guru';
                    } else {
                        throw new Error(result.message);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Terjadi kesalahan. Anda akan diarahkan ke dashboard.');
                    window.location.href = '/guru';
                }
            });

            // Tampilkan modal secara otomatis saat halaman dimuat
            welcomeModal.show();
        });
    </script>
</body>
</html>
